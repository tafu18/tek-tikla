name: ğŸ‘† Tek TÄ±kla Build

on:
  workflow_dispatch:
    inputs:
      profile:
        description: 'Build Profili SeÃ§in'
        required: true
        default: 'preview'
        type: choice
        options:
        - preview
        - production
        - development

jobs:
  build:
    name: TekTÄ±kla - ${{ inputs.profile }}
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ— Repo Checkout
        uses: actions/checkout@v4

      - name: â˜• Java Kurulumu
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: ğŸŸ¢ Node.js Kurulumu
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      # HATA Ã‡IKARAN GRADLE ADIMI KALDIRILDI
      # EAS Build kendi iÃ§inde ./gradlew kullanarak doÄŸru versiyonu Ã§ekecektir.

      - name: ğŸ“¦ BaÄŸÄ±mlÄ±lÄ±klarÄ± YÃ¼kle
        run: |
          npm install -g eas-cli
          npm install

      - name: ğŸš€ EAS Build BaÅŸlat
        env:
          EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}
        run: |
          npx eas-cli build --platform android --profile ${{ inputs.profile }} --local --non-interactive --output ./tektikla.apk

      - name: ğŸ“‚ DosyayÄ± YÃ¼kle (Artifact)
        uses: actions/upload-artifact@v4
        with:
          name: TekTikla-${{ inputs.profile }}-APK
          path: |
            ./tektikla.apk
            ./*.aab
            ./*.apk
          retention-days: 30
